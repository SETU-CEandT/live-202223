<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Computational Environments and Toolchains</title>

    <!-- Bootstrap core CSS -->
    <link href="../../../style/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../../../style/codehilite/css/default.css" rel="stylesheet">
    <link href="../../../style/misc/css/module.css" rel="stylesheet">
    <link href="../../../style/misc/css/practical.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

	<script type="text/javascript"
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>

  </head>

<body>

	<!-- Fixed navbar -->
	<div class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			
			
	    	<div class="collapse navbar-collapse">

				<ul class="nav navbar-nav navbar-left">
					<!-- Moodle -->
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="https://moodle.wit.ie/course/view.php?id=192126" target="_blank"><img height="18pt" src="../../../style/misc/img/moodle_logo_on_blue.gif" /></a>
						</div>						
					</li>
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="https://moodle.wit.ie/course/view.php?id=192126" target="_blank"><img height="18pt" src="../../../style/misc/img/slack_logo.png" /></a>
						</div>						
					</li>
				</ul>

	      		<ul class="nav navbar-nav navbar-right">

					<!-- module home -->
					<li>
						<div class="navbar-header">
							<a class="navbar-brand" href="../../../index.html"><span class="glyphicon glyphicon-home"></span></a>
						</div>						
					</li>
					
					<!-- topics -->
	        		<li>
						<div class="navbar-collapse collapse" id="b">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span class="glyphicon glyphicon-list-alt"></span>
									</a>
									<ul class="dropdown-menu" role="menu">
										<li class="dropdown-header">Topics</li>
										
										<li >
											<a href="../../../topics/01-Intro_to_Python/index.html">Intro to Python</a>
										</li>
										
										<li >
											<a href="../../../topics/02-Scientific_Computing_using_Python/index.html">Scientific Computing using Python</a>
										</li>
										
										<li >
											<a href="../../../topics/03-Computational_Problems_involving_Probability/index.html">Computational Problems involving Probability</a>
										</li>
										
										<li class="active">
											<a href="../../../topics/04-Implementing_Models/index.html">Implementing Models</a>
										</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li>

					<!-- resources -->
	        		<li>
						<div class="navbar-collapse collapse" id="b">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span class="glyphicon glyphicon-th-list"></span>
									</a>
									<ul class="dropdown-menu" role="menu">
										<li class="dropdown-header">Resources</li>
										
										<li class="active">
											<a href="../../../topics/04-Implementing_Models/index.html#01-Nonlinear_Pendulum">Nonlinear Pendulum</a>
										</li>
										
										<li >
											<a href="../../../topics/04-Implementing_Models/index.html#02-Rocket_Launch">Rocket Launch</a>
										</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li>
								
					<!-- pages-->
	        		<li>
						<div class="navbar-collapse collapse" id="c">
							<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="#" class="dropdown-toggle" data-toggle="dropdown">
										<span>Nonlinear</span
									</a>
									<ul class="dropdown-menu" role="menu">
										
										<li >
											<a href="00-Outline.html">Outline</a>
										</li>
										
										<li >
											<a href="01-Theory.html">Theory</a>
										</li>
										
										<li >
											<a href="02-Setup.html">Setup</a>
										</li>
										
										<li >
											<a href="03-Linear_Pendulum_-_Analytic.html">Linear Pendulum - Analytic</a>
										</li>
										
										<li >
											<a href="04-Linear_Pendulum_-_Numeric.html">Linear Pendulum - Numeric</a>
										</li>
										
										<li >
											<a href="05-Linear_Pendulum_-_Parameter_Estimation.html">Linear Pendulum - Parameter Estimation</a>
										</li>
										
										<li class="active">
											<a href="06-Nonlinear.html">Nonlinear</a>
										</li>
										
										<li >
											<a href="09-Period.html">Period</a>
										</li>
										
										<li >
											<a href="10-Assignment.html">Assignment</a>
										</li>
										
									</ul>
								</li>
							</ul>
						</div>			
					</li> 
					
	        	</ul>
			</div>
		</div>
	</div>

	<!-- contents -->
	<div class="container">
		
		<ul class="pager">
			
			<li class="previous"><a href="05-Linear_Pendulum_-_Parameter_Estimation.html">&larr; Previous (Linear Pendulum - Parameter Estimation)</a></li>
			
			
			
			<li class="next"><a href="09-Period.html">Next (Period) &rarr;</a></li>
			
		</ul>
		
		<h1>Nonlinear problem</h1>
<p><em>In this page we cover the non-linear pendulum.</em></p>
<p>Create a text cell and enter a level 2 heading with title <em>NonLinear Pendulum</em>.</p>
<h2>Summary</h2>
<p class="alert alert-warning">We next want to look at the nonlinear problem, but first I need to make a small change to our <code>getLinearAnalytic</code> and <code>getLinearNumeric</code> functions. </p>
<p>Copy the implementations of <code>getLinearAnalytic</code> and <code>getLinearNumeric</code> from section
 <em>Linear Pendulum (Analytic Solution)</em>, into this section and change both functions to</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getLinearAnalytic</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">g</span><span class="o">/</span><span class="n">L</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">ic</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">ic</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span>  <span class="n">A</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="n">tValues</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span><span class="o">/</span><span class="n">omega</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="n">tValues</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
</td></tr></table>
<p>and</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">getLinearNumeric</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span><span class="n">L</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">g</span><span class="o">/</span><span class="n">L</span> <span class="o">*</span> <span class="n">u</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">odeint</span><span class="p">(</span><span class="n">rhs</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">tValues</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))[:,</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<p class="alert alert-warning">The above change means we <strong>must</strong> pass in the initial conditions to both functions, rather than using a default.</p>
<h2>Implement the nonlinear problem</h2>
<p>Next, following the implementation of the numeric solution of the linear problem, define function <code>getNonlinearNumeric</code> which solves the nonlinear pendulum problem:</p>
<p>\[
    \frac{d^2\theta}{dt^2} = -\frac{g}{L} \sin(\theta)
\]</p>
<p>Generate the following graph showing the difference between the linear and the non-linear solution, under initial conditions \(\theta(0)=1, \dot\theta(0)=0\). </p>
<figure>
  <img src="files/linear_vs_nonlinear_1.png" alt="" width="70%" >
  <figcaption>'Linear vs Nonlinear Pendulum.</figcaption>
</figure>

<h2>Compute error in linear approximation with respect to IC</h2>
<p>The difference between the two solutions depends on the maximum magnitude of \(\theta\). Since the pendulum is initially stationary the maximum value of \(\theta\) is \(\theta(0)\). Looking at the above figure the nonlinearity appears to increase the period, while the amplitude is relatively unchanged. </p>
<p>Using parameters</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">g</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">tValues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p>generate the following graph, showing the error (defined as maximum absolute difference) in the linear approximation to the nonlinear pendulum as a function of the initial condition \(\theta(0)=A,\dot\theta(0)=0\) where \(0\le A\le \pi/2\).</p>
<figure>
  <img src="files/error_in_linear.png" alt="" width="70%" >
  <figcaption>'Linear vs Nonlinear Pendulum.</figcaption>
</figure>

<h2>Inverting a function (aka Root Finding)</h2>
<p>From the above graph we see that the error is monotonically increasing with respect to the initial position \(\theta(0)=A\). Say we want to ensure that the error is below some threshold value (lets pick 0.1), what is the maximum value for the initial position that we can now have? We could 'zoom' in to the above diagram to see that the maximum initial position is about 0.45. </p>
<figure>
  <img src="files/error_in_linear_0.png" alt="" width="30%" >
  <img src="files/error_in_linear_1.png" alt="" width="30%" >
  <img src="files/error_in_linear_2.png" alt="" width="30%" >
  <figcaption>'Zooming in Linear vs Nonlinear Pendulum.</figcaption>
</figure>

<p>We want to use python to automate this process and get a more accurate value.</p>
<h3>Problem Type: Root Finding</h3>
<p>Given function \(f(x)\) determine the value of \(x\) for which \(f(x)=0\).</p>
<p>Process</p>
<ul>
<li>
<p>import <code>root_scalar</code> from <code>scipy.optimize</code> </p>
</li>
<li>
<p>Define function \(f\). </p>
</li>
<li>
<p>Call <code>root_scalar</code> passing the function, any additional parameters and bounds (best guess or max and min) on the root.</p>
</li>
</ul>
<h3>Application of Root Finding</h3>
<p>Process</p>
<ul>
<li>import <code>root_scalar</code> from <code>scipy.optimize</code> using </li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root_scalar</span>
</code></pre></div>
</td></tr></table>
<ul>
<li>Define function \(f\). In this case we want the find input for which the output equals a non-zero value, so we just subtract our threshold value (of 0.1) from \(f\). Our function should compute the error in the linear approximation for a given initial position so we define </li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tValues</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>

    <span class="n">ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">linearNumeric</span> <span class="o">=</span> <span class="n">getLinearNumeric</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
    <span class="n">nonlinearNumeric</span> <span class="o">=</span> <span class="n">getNonlinearNumeric</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="n">g</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">linearNumeric</span><span class="o">-</span><span class="n">nonlinearNumeric</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">error</span> <span class="o">-</span> <span class="n">threshold</span>
</code></pre></div>
</td></tr></table>
<ul>
<li>Call <code>root_scalar</code> passing the function, any additional parameters and bounds (best guess or max and min) on the root.</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">root_scalar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">tValues</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">threshold</span><span class="p">),</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">])</span>
</code></pre></div>
</td></tr></table>
<p>which gives results</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>      converged: True
           flag: &#39;converged&#39;
 function_calls: 15
     iterations: 14
           root: 0.45161074415675995
</code></pre></div>
</td></tr></table>
		
		<ul class="pager">
			
			<li class="previous"><a href="05-Linear_Pendulum_-_Parameter_Estimation.html">&larr; Previous (Linear Pendulum - Parameter Estimation)</a></li>
			
			
			
			<li class="next"><a href="09-Period.html">Next (Period) &rarr;</a></li>
			
		</ul>

	</div>
	
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../../style/bootstrap/js/bootstrap.min.js"></script>
	
  </body>
</html>